server {
	listen 80;
	server_name _; # This doesn't do anything
	# disable any limits to avoid HTTP 413 for large image uploads
	client_max_body_size 0;

	# required to avoid HTTP 411: see Issue #1486 (https://github.com/docker/docker/issues/1486)
	chunked_transfer_encoding on;
	
	location /auth {
     		default_type "text/html";
     		root /usr/share/nginx/html;
     		index auth.html;
     		try_files  $uri $uri.html $uri/index.html index.html;
  	}

	location / {
	        proxy_redirect off;
	        proxy_http_version 1.1;
		proxy_pass http://grafana;
                resolver 127.0.0.1;
		#proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
                proxy_set_header Host $http_host;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "upgrade";
                proxy_set_header X-Forwarded-Proto $scheme;
                proxy_buffering off;
                proxy_request_buffering off;
		# proxy_cookie_path / "/; secure; SameSite=None";
		# proxy_set_header Authorization "";
		proxy_set_header X-WEBAUTH-USER $cookie_ncauth;
	}
	include errpages.conf;
}
#upstream grafana { server nc-grafana.nexclipper.svc.cluster.local; }
